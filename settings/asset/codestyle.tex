\RequirePackage{scrhack} % package for compatibility with listings
\RequirePackage{listings} % code formatting

%\usepackage{beramono} %Uncomment for IDE-style code font
%\usepackage{inconsolata} %Uncomment for scientific style code font

\newcommand{\CodeSymbol}[1]{\textcolor{blue}{#1}}

\renewcommand*{\lstlistingname}{Code}
\renewcommand*{\lstlistlistingname}{Codeverzeichnis}

% "\code"-Box
\usepackage{soul}

\newcommand{\code}[2][codebackgroundcolor]{%
  \begingroup
  \sethlcolor{#1}%
  \hl{#2}%
  \endgroup
}

\makeatletter
% fix linebreak=true breaking literate of ')', see: https://tex.stackexchange.com/questions/69472/closing-parenthesis-as-delimiter-not-matched-when-breaklines-true
\patchcmd{\lsthk@SelectCharTable}{\lst@ifbreaklines\lst@Def{`)}{\lst@breakProcessOther)}\fi}{}{}{}
\makeatother

% language definition: Java (example)
\lstdefinestyle{Java}{
  % Styling
  captionpos=b,
  columns=fullflexible,
  % Colors
  backgroundcolor=\color{codebackgroundcolor},
  commentstyle=\color{codegreen},
  keywordstyle=\color{blue},
  numberstyle=\tiny\color{codegray},
  stringstyle=\color{codegreen},
  basicstyle=\ttfamily\footnotesize,
  % Spaces
  keepspaces=true,
  showspaces=false,
  showtabs=false,
  tabsize=2,
  breakatwhitespace=true,
  breaklines=true,
  showstringspaces=false,
  postbreak=\mbox{\textcolor{black}{$\hookrightarrow$}\space},
  % Line numbers
  numbers=left,
  numbersep=5pt,
  % Additional keywords
  otherkeywords={var},
  % Literates
  literate=
  % Curly braces
  {\{}{{\CodeSymbol{\{}}}1
  {\}}{{\CodeSymbol{\}}}}1
  % Parantheses
  {(}{{\CodeSymbol{(}}}1
  {)}{{\CodeSymbol{)}}}1
  % Brackets
  {[}{{\CodeSymbol{[}}}1
  {]}{{\CodeSymbol{]}}}1
  % Maths
  {>}{{\CodeSymbol{$>$}}}1
  {=}{{\CodeSymbol{$=$}}}1
  {;}{{\CodeSymbol{$;$}}}1
}
\lstset{style=Java}
\lstset{texcl=true}

\lstdefinelanguage{XML}
{
  morestring=[b]",
  morestring=[s]{>}{<},
  morecomment=[s]{<?}{?>},
  morecomment=[s]{<!--}{-->},
  stringstyle=\color{black},
  identifierstyle=\color{darkblue},
  keywordstyle=\color{cyan}
}

% listing listing
\NewDocumentCommand{\beginListing}{ m m m }{
  \begin{lstlisting}[language=#1, caption=#2, label=lst:#3,
        % morecomment appears to only work in this scenario but not the style
        morecomment={[n][\color{codegreen}]{/**}{*/}}, % Javadoc
        morecomment={[n][\color{pred}]{@}{\^^M}} % Annotation (Java)
  ]
}